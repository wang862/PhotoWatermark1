# 图片水印命令行程序

## 1. 产品概述

本产品是一个命令行工具，用于读取图片的EXIF信息中的拍摄时间，并将其作为水印添加到图片上。用户可以自定义水印的字体大小、颜色和位置，处理后的图片将保存在原目录的子目录中。

## 2. 功能需求

### 2.1 图片读取功能
- 用户通过命令行参数输入一个图片文件路径
- 程序能够读取该路径下的图片文件

### 2.2 EXIF信息解析功能
- 读取图片文件的EXIF信息
- 提取EXIF信息中的拍摄时间（年月日部分）

### 2.3 水印设置功能
- 用户可以设置水印文本的字体大小
- 用户可以设置水印文本的颜色
- 用户可以设置水印在图片上的位置（左上角、居中、右下角等选项）

### 2.4 水印绘制功能
- 将提取的拍摄时间作为文本水印绘制到图片上
- 应用用户设置的字体大小、颜色和位置

### 2.5 图片保存功能
- 将添加水印后的图片保存为新的图片文件
- 保存路径为原目录下创建的名为"原目录名_watermark"的子目录
- 保持原图片的格式和质量

## 3. 技术要求

### 3.1 开发语言
- 使用C或C++语言开发
- 不依赖额外需要安装的库
- 使用标准库和系统API

### 3.2 支持的图片格式
- 支持常见的图片格式，如JPEG、PNG等
- 优先支持JPEG格式（通常包含EXIF信息）

### 3.3 系统兼容性
- 支持Windows、Linux和macOS操作系统
- 确保在不同系统上的行为一致性

## 4. 命令行接口

### 4.1 基本命令格式
```
photo_watermark <image_path> [options]
```

### 4.2 参数说明
- `<image_path>`: 必需参数，指定图片文件路径
- `--font-size <size>`: 可选参数，设置水印字体大小，默认值为12
- `--color <color_code>`: 可选参数，设置水印颜色，格式为RGB十六进制值（如FF0000表示红色），默认值为黑色（000000）
- `--position <position>`: 可选参数，设置水印位置，可选值为：top-left（左上角）、center（居中）、bottom-right（右下角）等，默认值为右下角
- `--help`: 显示帮助信息

## 5. 流程图

1. 用户输入命令行参数
2. 程序解析命令行参数
3. 程序读取指定路径的图片文件
4. 程序解析图片的EXIF信息，提取拍摄时间
5. 程序根据用户设置，在图片上绘制水印
6. 程序创建保存目录（如果不存在）
7. 程序保存添加水印后的图片
8. 程序输出处理结果信息

## 6. 输入输出示例

### 6.1 输入示例
```
photo_watermark ./photos/sample.jpg --font-size 16 --color FF0000 --position bottom-right
```

### 6.2 输出示例
```
处理成功！
原图路径：./photos/sample.jpg
水印图片保存路径：./photos_watermark/sample_watermark.jpg
水印内容：2023-10-15
```

## 7. 约束条件

- 程序必须能够处理没有EXIF信息的图片，此时可以使用当前日期作为水印
- 程序必须能够处理大图片，避免内存溢出
- 程序必须有适当的错误处理机制，如文件不存在、无法读取EXIF信息等情况
- 程序应该保持代码简洁高效

## 8. 后续可能的扩展功能

- 支持批量处理多个图片
- 支持自定义水印文本
- 支持添加图片水印
- 支持调整水印透明度
- 支持旋转水印方向

## 9. 开发计划

1. 完成基本框架和命令行参数解析
2. 实现EXIF信息读取功能
3. 实现图片水印绘制功能
4. 实现图片保存功能
5. 进行测试和优化
6. 编写使用文档